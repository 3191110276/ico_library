[{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Description":"Delete Cisco Intersight Kubernetes Cluster Profile","Label":"Delete Cluster Profile","Name":"DeleteClusterProfile","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Moid of the Cluster Profile that should be deleted","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Moid","Name":"moid","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryCount":256,"RetryDelay":20,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":600,"TimeoutPolicy":"Timeout"},"RollbackTasks":[],"SharedScope":"user","Tags":[{"Key":"category","Value":"Cisco Intersight Kubernetes"}],"Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Description":"Create Cisco Intersight Kubernetes Cluster Profile","Label":"Create Cluster Profile","Name":"CreateClusterProfile","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The name of the Cluster Profile to be created","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Name","Name":"name","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The SSH key that should be deposited on the Kubernetes cluster to allow for SSH access","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"SSH Key","Name":"sshkey","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The IP Pool that will be used for Cluster-level IP addresses, such as load balancers","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"IP Pool","Name":"ippool","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[{"DisplayAttributes":["Name","Moid"],"ObjectType":"workflow.MoReferenceProperty","Selector":"/api/v1/ippool/Pools","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"ValueAttribute":"Moid"}],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The amount of load balancer IPs deployed for this cluster","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Load Balancer Count","Name":"loadbalancercount","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"Max":100,"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"integer"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Container Runtime policy used for this cluster","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Container Runtime Policy","Name":"runtimeconfig","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[{"DisplayAttributes":["Name","Moid"],"ObjectType":"workflow.MoReferenceProperty","Selector":"/api/v1/kubernetes/ContainerRuntimePolicies","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"ValueAttribute":"Moid"}],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Network CIDR policy used for this cluster","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Network CIDR Policy","Name":"netconfig","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[{"DisplayAttributes":["Name","Moid"],"ObjectType":"workflow.MoReferenceProperty","Selector":"/api/v1/kubernetes/NetworkPolicies","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"ValueAttribute":"Moid"}],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Node OS Configuration policy used for this cluster","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Node OS Configuration Policy","Name":"sysconfig","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[{"DisplayAttributes":["Name","Moid"],"ObjectType":"workflow.MoReferenceProperty","Selector":"/api/v1/kubernetes/SysConfigPolicies","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"ValueAttribute":"Moid"}],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true},{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Trusted Certificate Authorities policy used for this cluster","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Trusted Certificate Authorities Policy","Name":"trustedcertauth","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"}}],"ObjectType":"workflow.Properties","OutputDefinition":[{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Moid of the Cluster Profile that was created","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Moid","Name":"moid","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true}],"RetryCount":5,"RetryDelay":60,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":600,"TimeoutPolicy":"Timeout"},"RollbackTasks":[{"CatalogMoid":"user","Description":"Delete Cisco Intersight Kubernetes Cluster Profile","InputParameters":{"moid":"${task.output.moid}"},"Name":"DeleteClusterProfile","ObjectType":"workflow.RollbackTask","Version":1}],"SharedScope":"user","Tags":[{"Key":"category","Value":"Cisco Intersight Kubernetes"}],"Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"Batch":[{"ContentType":"json","Description":"Validate Cisco Intersight Kubernetes Cluster Profile State","EndpointRequestType":"Internal","Label":"Validate Cisco Intersight Kubernetes Cluster Profile State","Method":"GET","Name":"ValidateCiscoIntersightKubernetesClusterProfileState","ObjectType":"workflow.WebApi","Outcomes":[],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"ControlAction","ObjectType":"content.Parameter","Path":"$.ConfigContext.ControlAction","Secure":false,"Type":"string"}],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"},{"ContentType":"json","Description":"Delete Cisco Intersight Kubernetes Cluster Profile","EndpointRequestType":"Internal","Label":"Delete Cisco Intersight Kubernetes Cluster Profile","Method":"DELETE","Name":"DeleteCiscoIntersightKubernetesClusterProfile","ObjectType":"workflow.WebApi","Outcomes":[],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"}],"ClassId":"workflow.BatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Description":"Delete Cisco Intersight Kubernetes Cluster Profile","Name":"Delete Cluster Profile","ObjectType":"workflow.BatchApiExecutor","Output":{},"RetryFromFailedApi":true,"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"DeleteClusterProfile\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/BatchApiExecutors","Verb":"POST"},{"Body":{"Batch":[{"Body":"{\r\n    \"Name\":\"{{.global.task.input.name}}\",\r\n    \"Organization\":\"{{.security.OrganizationMoid}}\",\r\n    \"ManagementConfig\":{\r\n        \"LoadBalancerCount\":{{.global.task.input.loadbalancercount}},\r\n        \"SshUser\": \"iksadmin\",\r\n        \"SshKeys\": [\"{{.global.task.input.sshkey}}\"]\r\n    },\r\n    \"ClusterIpPools\": [{\r\n      \"ClassId\": \"mo.MoRef\",\r\n      \"Moid\": \"{{.global.task.input.ippool}}\",\r\n      \"ObjectType\": \"ippool.Pool\",\r\n      \"link\": \"https://www.intersight.com/api/v1/ippool/Pools/{{.global.task.input.ippool}}\"\r\n    }],\r\n    \"ContainerRuntimeConfig\": {\r\n      \"ClassId\": \"mo.MoRef\",\r\n      \"Moid\": \"{{.global.task.input.runtimeconfig}}\",\r\n      \"ObjectType\": \"kubernetes.ContainerRuntimePolicy\",\r\n      \"link\": \"https://www.intersight.com/api/v1/kubernetes/ContainerRuntimePolicies/{{.global.task.input.runtimeconfig}}\"\r\n    },\r\n    \"NetConfig\": {\r\n      \"ClassId\": \"mo.MoRef\",\r\n      \"Moid\": \"{{.global.task.input.netconfig}}\",\r\n      \"ObjectType\": \"kubernetes.NetworkPolicy\",\r\n      \"link\": \"https://www.intersight.com/api/v1/kubernetes/NetworkPolicies/{{.global.task.input.netconfig}}\"\r\n    },\r\n    \"SysConfig\": {\r\n      \"ClassId\": \"mo.MoRef\",\r\n      \"Moid\": \"{{.global.task.input.sysconfig}}\",\r\n      \"ObjectType\": \"kubernetes.SysConfigPolicy\",\r\n      \"link\": \"https://www.intersight.com/api/v1/kubernetes/SysConfigPolicies/{{.global.task.input.sysconfig}}\"\r\n    },\r\n    {{with $x := .global.task.input.trustedcertauth}}\r\n    \"TrustedRegistries\": {\r\n      \"ClassId\": \"mo.MoRef\",\r\n      \"Moid\": \"{{$x}}\",\r\n      \"ObjectType\": \"kubernetes.TrustedRegistriesPolicy\",\r\n      \"link\": \"https://www.intersight.com/api/v1/kubernetes/TrustedRegistriesPolicies/{{$x}}\"\r\n    },\r\n    {{end}}\r\n    \"ManagedMode\":\"Managed\"\r\n}","ContentType":"json","Description":"Create Cisco Intersight Kubernetes Cluster Profile","EndpointRequestType":"Internal","Label":"Create Cisco Intersight Kubernetes Cluster Profile","Method":"POST","Name":"CreateCiscoIntersightKubernetesClusterProfile","ObjectType":"workflow.WebApi","Outcomes":[],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"moid","ObjectType":"content.Parameter","Path":"$.Moid","Secure":false,"Type":"string"}],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles"}],"ClassId":"workflow.BatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Description":"Create Cisco Intersight Kubernetes Cluster Profile","Name":"Create Cluster Profile","ObjectType":"workflow.BatchApiExecutor","Output":{"moid":"{{.global.CreateCiscoIntersightKubernetesClusterProfile.output.moid}}"},"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"CreateClusterProfile\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/BatchApiExecutors","Verb":"POST"}]

[{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Description":"Undeploy Cisco Intersight Kubernetes Cluster Profile","Label":"Undeploy Cluster Profile","Name":"UndeployClusterProfile","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Moid of the Cluster Profile that should be deleted","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Moid","Name":"moid","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryCount":256,"RetryDelay":20,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":600,"TimeoutPolicy":"Retry"},"RollbackTasks":[{"CatalogMoid":"user","Description":"Deploy Cisco Intersight Kubernetes Cluster Profile","InputParameters":{"moid":"${task.input.moid}"},"Name":"DeployClusterProfile","ObjectType":"workflow.RollbackTask","Version":1}],"SharedScope":"user","Tags":[{"Key":"category","Value":"Cisco Intersight Kubernetes"}],"Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"ClassId":"workflow.TaskDefinition","DefaultVersion":true,"Description":"Deploy Cisco Intersight Kubernetes Cluster Profile","Label":"Deploy Cluster Profile","Name":"DeployClusterProfile","ObjectType":"workflow.TaskDefinition","Properties":{"ExternalMeta":true,"InputDefinition":[{"Default":{"ObjectType":"workflow.DefaultValue"},"Description":"The Moid of the Cluster Profile that should be deployed","DisplayMeta":{"InventorySelector":true,"ObjectType":"workflow.DisplayMeta","WidgetType":"None"},"Label":"Moid","Name":"moid","ObjectType":"workflow.PrimitiveDataType","Properties":{"Constraints":{"EnumList":[],"ObjectType":"workflow.Constraints"},"InventorySelector":[{"DisplayAttributes":["Name","Moid"],"ObjectType":"workflow.MoReferenceProperty","Selector":"/api/v1/kubernetes/ClusterProfiles","SelectorProperty":{"Method":"GET","ObjectType":"workflow.SelectorProperty"},"ValueAttribute":"Moid"}],"ObjectType":"workflow.PrimitiveDataProperty","Type":"string"},"Required":true}],"ObjectType":"workflow.Properties","OutputDefinition":[],"RetryCount":256,"RetryDelay":20,"RetryPolicy":"Fixed","SupportStatus":"Supported","Timeout":600,"TimeoutPolicy":"Retry"},"RollbackTasks":[{"CatalogMoid":"user","Description":"Undeploy Cisco Intersight Kubernetes Cluster Profile","InputParameters":{"moid":"${task.input.moid}"},"Name":"UndeployClusterProfile","ObjectType":"workflow.RollbackTask","Version":1}],"SharedScope":"user","Tags":[{"Key":"category","Value":"Cisco Intersight Kubernetes"}],"Version":1},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/TaskDefinitions","Verb":"POST"},{"Body":{"Batch":[{"ContentType":"json","Description":"Validate Cisco Intersight Kubernetes Cluster Profile State","EndpointRequestType":"Internal","Label":"Validate Cisco Intersight Kubernetes Cluster Profile State","Method":"GET","Name":"ValidateCiscoIntersightKubernetesClusterProfileState","ObjectType":"workflow.WebApi","Outcomes":[{"Condition":"{{ ne .global.ValidateCiscoIntersightKubernetesClusterProfileState.output.ControlAction \"No-op\"}}","Message":"Waiting for Cluster Profile changes to be applied","Name":"Wait until Cluster Profile is not being changed","ObjectType":"workflow.Outcome","Type":"Status"},{"Condition":"{{ or (eq .global.ValidateCiscoIntersightKubernetesClusterProfileState.output.ControlAction \"No-op\") (eq .global.ValidateCiscoIntersightKubernetesClusterProfileState.output.ControlAction \"\") }}","Message":"Cluster Profile is ready to be deployed","Name":"Cluster Profile is ready","ObjectType":"workflow.Outcome","Type":"Success"}],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"ControlAction","ObjectType":"content.Parameter","Path":"$.ConfigContext.ControlAction","Secure":false,"Type":"string"}],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"},{"Body":"{\"Action\":\"Undeploy\"}","ContentType":"json","Description":"Undeploy Cisco Intersight Kubernetes Cluster Profile","EndpointRequestType":"Internal","Label":"Undeploy Cisco Intersight Kubernetes Cluster Profile","Method":"POST","Name":"UndeployCiscoIntersightKubernetesClusterProfile","ObjectType":"workflow.WebApi","Outcomes":[{"Condition":".local.response.HttpStatusCode ne 200","Message":"Failed to undeploy Cluster Profile","Name":"HTTP Status Code Check","ObjectType":"workflow.Outcome","Type":"Error"}],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"},{"ContentType":"json","Description":"Wait for Cisco Intersight Kubernetes Cluster Profile undeployment","EndpointRequestType":"Internal","Label":"Wait for Cisco Intersight Kubernetes Cluster Profile undeployment","Method":"GET","Name":"WaitforCiscoIntersightKubernetesClusterProfileundeployment","ObjectType":"workflow.WebApi","Outcomes":[{"Condition":"{{ or (eq .global.WaitforCiscoIntersightKubernetesClusterProfileundeployment.output.ControlAction \"Deploy\") (eq .global.WaitforCiscoIntersightKubernetesClusterProfileundeployment.output.ControlAction \"Undeploy\") }}","Message":"Waiting for Cluster Profile to be undeployed","Name":"Wait until Cluster Profile is not being changed","ObjectType":"workflow.Outcome","Type":"Status"},{"Condition":"{{ or (eq .global.WaitforCiscoIntersightKubernetesClusterProfileundeployment.output.ControlAction \"No-op\") (eq .global.WaitforCiscoIntersightKubernetesClusterProfileundeployment.output.ControlAction \"\") }}","Message":"Cluster Undeployment finished","Name":"Cluster Undeployment finished","ObjectType":"workflow.Outcome","Type":"Success"}],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"ControlAction","ObjectType":"content.Parameter","Path":"$.ConfigContext.ControlAction","Secure":false,"Type":"string"}],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"}],"ClassId":"workflow.BatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Description":"Undeploy Cisco Intersight Kubernetes Cluster Profile","Name":"Undeploy Cluster Profile","ObjectType":"workflow.BatchApiExecutor","Output":{},"RetryFromFailedApi":true,"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"UndeployClusterProfile\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/BatchApiExecutors","Verb":"POST"},{"Body":{"Batch":[{"ContentType":"json","Description":"Validate Cisco Intersight Kubernetes Cluster Profile State","EndpointRequestType":"Internal","Label":"Validate Cisco Intersight Kubernetes Cluster Profile State","Method":"GET","Name":"ValidateCiscoIntersightKubernetesClusterProfileState","ObjectType":"workflow.WebApi","Outcomes":[{"Condition":"{{ or (eq .global.ValidateCiscoIntersightKubernetesClusterProfileState.output.ControlAction \"Deploy\") (eq .global.ValidateCiscoIntersightKubernetesClusterProfileState.output.ControlAction \"Undeploy\") }}","Message":"Waiting for Cluster Profile changes to be applied","Name":"Wait until Cluster Profile is not being changed","ObjectType":"workflow.Outcome","Type":"Status"},{"Condition":"{{ or (eq .global.ValidateCiscoIntersightKubernetesClusterProfileState.output.ControlAction \"No-op\") (eq .global.ValidateCiscoIntersightKubernetesClusterProfileState.output.ControlAction \"\") }}","Message":"Cluster Profile is ready to be deployed","Name":"Cluster Profile is ready","ObjectType":"workflow.Outcome","Type":"Success"}],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"ControlAction","ObjectType":"content.Parameter","Path":"$.ConfigContext.ControlAction","Secure":false,"Type":"string"}],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"},{"Body":"{\"Action\":\"Deploy\"}","ContentType":"json","Description":"Deploy Cisco Intersight Kubernetes Cluster Profile","EndpointRequestType":"Internal","Label":"Deploy Cisco Intersight Kubernetes Cluster Profile","Method":"POST","Name":"DeployCiscoIntersightKubernetesClusterProfile","ObjectType":"workflow.WebApi","Outcomes":[{"Condition":".local.response.HttpStatusCode ne 200","Message":"Failed to deploy Cluster Profile","Name":"HTTP Status Code Check","ObjectType":"workflow.Outcome","Type":"Error"},{"Condition":".local.response.HttpStatusCode eq 200","Message":"Deployment successfully started","Name":"HTTP Status Code Check Success","ObjectType":"workflow.Outcome","Type":"Success"}],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"},{"ContentType":"json","Description":"Wait for Cisco Intersight Kubernetes Cluster Profile deployment","EndpointRequestType":"Internal","Label":"Wait for Cisco Intersight Kubernetes Cluster Profile deployment","Method":"GET","Name":"WaitforCiscoIntersightKubernetesClusterProfiledeployment","ObjectType":"workflow.WebApi","Outcomes":[{"Condition":"{{ or (eq .global.WaitforCiscoIntersightKubernetesClusterProfiledeployment.output.ControlAction \"Deploy\") (eq .global.WaitforCiscoIntersightKubernetesClusterProfiledeployment.output.ControlAction \"Undeploy\") }}","Message":"Waiting for Cluster Profile to be deployed","Name":"Wait until Cluster Profile is not being changed","ObjectType":"workflow.Outcome","Type":"Status"},{"Condition":"{{ or (eq .global.WaitforCiscoIntersightKubernetesClusterProfiledeployment.output.ControlAction \"No-op\") (eq .global.WaitforCiscoIntersightKubernetesClusterProfiledeployment.output.ControlAction \"\") }}","Message":"Cluster Deployment finished","Name":"Cluster Deployment finished","ObjectType":"workflow.Outcome","Type":"Success"}],"Protocol":"https","ResponseSpec":{"ErrorParameters":[],"ObjectType":"content.Grammar","Parameters":[{"AcceptSingleValue":false,"ComplexType":"","ItemType":"simple","Name":"ControlAction","ObjectType":"content.Parameter","Path":"$.ConfigContext.ControlAction","Secure":false,"Type":"string"}],"Types":[]},"TargetType":"Local","Url":"/api/v1/kubernetes/ClusterProfiles/{{.global.task.input.moid}}"}],"ClassId":"workflow.BatchApiExecutor","Constraints":{"ObjectType":"workflow.TaskConstraints"},"Description":"Deploy Cisco Intersight Kubernetes Cluster Profile","Name":"Deploy Cluster Profile","ObjectType":"workflow.BatchApiExecutor","Output":{},"RetryFromFailedApi":true,"SharedScope":"user","TaskDefinition":{"ObjectType":"workflow.TaskDefinition","Selector":"Name eq \"DeployClusterProfile\" and Version eq 1"}},"ClassId":"bulk.RestSubRequest","ObjectType":"bulk.RestSubRequest","TargetMoid":"","Uri":"/v1/workflow/BatchApiExecutors","Verb":"POST"}]
